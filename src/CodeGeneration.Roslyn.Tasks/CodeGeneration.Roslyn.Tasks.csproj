<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <TargetFrameworks>net452;netcoreapp1.0</TargetFrameworks>
    <AssemblyOriginatorKeyFile>..\opensource.snk</AssemblyOriginatorKeyFile>
    <SignAssembly>true</SignAssembly>
    <PackageTargetFallback>$(PackageTargetFallback);portable-net45+win8+wp8+wpa81;</PackageTargetFallback>
    <PackageId>CodeGeneration.Roslyn.BuildTime</PackageId>
    <Description>The build-time development dependency that generates code for a project that consumes code generation attributes.</Description>

    <!-- We're going to include it by virtue of sending the whole bin dir to the build folder. -->
    <IncludeBuildOutput>false</IncludeBuildOutput>
  </PropertyGroup>

  <ItemGroup>
    <AdditionalFiles Include="..\stylecop.json">
      <Visible>false</Visible>
    </AdditionalFiles>
  </ItemGroup>

  <Target Name="CollectRuntimeOutputs" BeforeTargets="_GetPackageFiles">
    <ItemGroup>
      <Content Include="$(OutputPath)**\*.dll;$(OutputPath)**\*.json">
        <Pack>true</Pack>
        <PackagePath>build\</PackagePath>
      </Content>
    </ItemGroup>
  </Target>

  <Target Name="CopyLocalPackageReferences"
          AfterTargets="ResolveLockFileReferences"
          Condition=" '$(TargetFramework)' == 'netcoreapp1.0' ">
    <ItemGroup>
      <None Include="@(FileDependencies->'$(NuGetPackageRoot)%(Identity)')"
            Condition=" '%(FileDependencies.FileGroup)' == 'RuntimeAssembly' and
              '%(FileDependencies.ParentTarget)' == '.NETCoreApp,Version=v1.0' and (
              '%(FileName)' == 'Microsoft.CodeAnalysis' or
              '%(FileName)' == 'Microsoft.CodeAnalysis.CSharp' or
              '%(FileName)' == 'Microsoft.CodeAnalysis.CSharp.Workspaces' or
              '%(FileName)' == 'Microsoft.CodeAnalysis.Workspaces' or
              '%(FileName)' == 'System.Composition.AttributedModel' or
              '%(FileName)' == 'System.Composition.Convention' or
              '%(FileName)' == 'System.Composition.Hosting' or
              '%(FileName)' == 'System.Composition.Runtime' or
              '%(FileName)' == 'System.Composition.TypedParts' or
              '%(FileName)' == 'System.Collections.Immutable' or
              '%(FileName)' == 'System.Reflection.Metadata' or
              '%(FileName)' == 'Validation' or
              false
              )">
        <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
      </None>
    </ItemGroup>
  </Target>

  <ItemGroup>
    <Content Include="build\*.props;build\*.targets">
      <Pack>true</Pack>
      <PackagePath>build\</PackagePath>
    </Content>
  </ItemGroup>

  <ItemDefinitionGroup>
    <PackageReference>
      <PrivateAssets>all</PrivateAssets>
    </PackageReference>
    <ProjectReference>
      <PrivateAssets>all</PrivateAssets>
    </ProjectReference>
  </ItemDefinitionGroup>

  <ItemGroup>
    <ProjectReference Include="..\CodeGeneration.Roslyn\CodeGeneration.Roslyn.csproj" />
  </ItemGroup>

  <ItemGroup>
    <PackageReference Include="Microsoft.CodeAnalysis.CSharp.Workspaces" Version="1.3.2" />
  </ItemGroup>

  <ItemGroup Condition="'$(TargetFramework)' == 'net452'">
    <PackageReference Include="Microsoft.Build.Tasks.Core" Version="14.3" Condition=" '$(TargetFramework)' == 'net452' " />
  </ItemGroup>

  <ItemGroup Condition="'$(TargetFramework)' == 'netcoreapp1.0'">
    <PackageReference Include="System.Runtime.Loader" Version="4.3.0" />
    <PackageReference Include="Microsoft.Build.Tasks.Core" Version="15.1.0-preview-000458-02" />
  </ItemGroup>
  
</Project>
